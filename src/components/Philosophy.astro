---
interface Principle {
  icon: string;
  title: string;
  description: string;
}

interface Props {
  statement: string;
  principles: Principle[];
}

const { statement, principles } = Astro.props;

// Split statement to highlight "hardened infrastructure"
const [before, after] = statement.split('hardened infrastructure');
---

<section class="bento-card p-8 overflow-hidden mb-6" aria-labelledby="philosophy-heading">
  <div class="grid md:grid-cols-2 gap-12 items-center">
    <div>
      <h2 id="philosophy-heading" class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-6 flex items-center gap-2">
        <span class="material-symbols-outlined text-sm" aria-hidden="true">architecture</span>
        The Architectural Philosophy
      </h2>
      <p class="text-2xl font-light text-white leading-relaxed mb-8">
        "{before}<span class="text-indigo-400 font-medium">hardened infrastructure</span>{after}"
      </p>
      <div class="grid grid-cols-2 gap-4">
        {principles.slice(0, 2).map(p => (
          <div class="principle-box p-4 rounded-2xl bg-slate-900/50 border border-slate-800">
            <span class="material-symbols-outlined text-indigo-400 mb-2 block">{p.icon}</span>
            <h4 class="text-sm font-bold text-white mb-1">{p.title}</h4>
            <p class="text-xs text-slate-400">{p.description}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- Interactive Architecture Diagram -->
    <figure class="relative bg-slate-950 rounded-2xl border border-slate-800 shadow-2xl h-[340px] overflow-hidden" id="arch-diagram" role="img" aria-label="Interactive cloud architecture diagram showing CloudFront, API Gateway, Lambda, EKS, DynamoDB, Bedrock AI, and Redis components with animated data flow">
      <!-- Animated grid background -->
      <div class="absolute inset-0 opacity-[0.07]">
        <svg class="w-full h-full" viewBox="0 0 400 340" preserveAspectRatio="xMidYMid slice">
          <defs>
            <pattern id="grid-pattern" width="20" height="20" patternUnits="userSpaceOnUse">
              <path d="M 20 0 L 0 0 0 20" fill="none" stroke="currentColor" stroke-width="0.5"/>
            </pattern>
          </defs>
          <rect width="400" height="340" fill="url(#grid-pattern)"/>
        </svg>
      </div>

      <!-- SVG Connection Lines - positioned behind nodes -->
      <svg class="absolute inset-0 w-full h-full" style="z-index: 1;">
        <defs>
          <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="2" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- CloudFront to API Gateway (vertical) -->
        <line x1="50%" y1="52" x2="50%" y2="85" stroke="#6366f1" stroke-width="2" opacity="0.5"/>

        <!-- API Gateway to Lambda (diagonal left) -->
        <path d="M 43% 115 L 30% 155" fill="none" stroke="#10b981" stroke-width="2" opacity="0.5"/>

        <!-- API Gateway to EKS (diagonal right) -->
        <path d="M 57% 115 L 70% 155" fill="none" stroke="#10b981" stroke-width="2" opacity="0.5"/>

        <!-- Lambda to DynamoDB -->
        <path d="M 30% 195 L 50% 230" fill="none" stroke="#a855f7" stroke-width="2" opacity="0.5"/>

        <!-- EKS to DynamoDB -->
        <path d="M 70% 195 L 50% 230" fill="none" stroke="#a855f7" stroke-width="2" opacity="0.5"/>

        <!-- Lambda to Bedrock (left) -->
        <path d="M 22% 175 L 12% 230" fill="none" stroke="#f59e0b" stroke-width="1.5" stroke-dasharray="4,4" opacity="0.5"/>

        <!-- EKS to Redis (right) -->
        <path d="M 78% 175 L 88% 230" fill="none" stroke="#ef4444" stroke-width="1.5" opacity="0.5"/>

        <!-- Animated particles -->
        <g filter="url(#glow)">
          <!-- CloudFront to API Gateway particle -->
          <circle r="4" fill="#6366f1">
            <animate attributeName="cy" values="52;85;52" dur="1.5s" repeatCount="indefinite"/>
            <animate attributeName="cx" values="50%;50%;50%" dur="1.5s" repeatCount="indefinite"/>
          </circle>

          <!-- API Gateway to Lambda particle -->
          <circle r="3" fill="#10b981">
            <animate attributeName="cx" values="43%;30%;43%" dur="2s" repeatCount="indefinite"/>
            <animate attributeName="cy" values="115;155;115" dur="2s" repeatCount="indefinite"/>
          </circle>

          <!-- API Gateway to EKS particle -->
          <circle r="3" fill="#10b981">
            <animate attributeName="cx" values="57%;70%;57%" dur="2s" repeatCount="indefinite" begin="0.5s"/>
            <animate attributeName="cy" values="115;155;115" dur="2s" repeatCount="indefinite" begin="0.5s"/>
          </circle>

          <!-- Lambda to DynamoDB particle -->
          <circle r="3" fill="#a855f7">
            <animate attributeName="cx" values="30%;50%;30%" dur="1.8s" repeatCount="indefinite" begin="0.3s"/>
            <animate attributeName="cy" values="195;230;195" dur="1.8s" repeatCount="indefinite" begin="0.3s"/>
          </circle>

          <!-- EKS to DynamoDB particle -->
          <circle r="3" fill="#a855f7">
            <animate attributeName="cx" values="70%;50%;70%" dur="1.8s" repeatCount="indefinite" begin="0.8s"/>
            <animate attributeName="cy" values="195;230;195" dur="1.8s" repeatCount="indefinite" begin="0.8s"/>
          </circle>

          <!-- Bedrock particle -->
          <circle r="2.5" fill="#f59e0b">
            <animate attributeName="cx" values="22%;12%;22%" dur="2.5s" repeatCount="indefinite"/>
            <animate attributeName="cy" values="175;230;175" dur="2.5s" repeatCount="indefinite"/>
          </circle>

          <!-- Redis particle -->
          <circle r="2.5" fill="#ef4444">
            <animate attributeName="cx" values="78%;88%;78%" dur="2s" repeatCount="indefinite" begin="0.4s"/>
            <animate attributeName="cy" values="175;230;175" dur="2s" repeatCount="indefinite" begin="0.4s"/>
          </circle>
        </g>
      </svg>

      <!-- Architecture Nodes - absolutely positioned -->
      <div class="absolute inset-0" style="z-index: 2;">

        <!-- Row 1: CloudFront (centered at top) -->
        <div class="absolute left-1/2 -translate-x-1/2 top-4">
          <div class="arch-node group" data-tooltip="Edge CDN - Global Distribution">
            <div class="px-4 py-2 rounded-lg bg-indigo-500/20 border border-indigo-500/50 flex items-center justify-center group-hover:border-indigo-400 group-hover:bg-indigo-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="text-[10px] font-mono text-indigo-400 font-semibold">CloudFront</span>
            </div>
          </div>
        </div>

        <!-- Monitoring (top right) -->
        <div class="absolute right-4 top-4">
          <div class="arch-node group" data-tooltip="OpenTelemetry + X-Ray">
            <div class="w-10 h-10 rounded-lg bg-slate-800/80 border border-cyan-500/50 flex items-center justify-center group-hover:border-cyan-400 transition-all cursor-pointer">
              <span class="material-symbols-outlined text-cyan-400 text-base">monitoring</span>
            </div>
          </div>
        </div>

        <!-- Row 2: API Gateway -->
        <div class="absolute left-1/2 -translate-x-1/2 top-[85px]">
          <div class="arch-node group" data-tooltip="FAPI/OAuth2 Compliant">
            <div class="px-3 py-1.5 rounded-lg bg-indigo-500/20 border border-indigo-500/50 flex items-center gap-1.5 group-hover:border-indigo-400 group-hover:bg-indigo-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="material-symbols-outlined text-indigo-400 text-sm">api</span>
              <span class="text-[9px] font-mono text-indigo-400">API Gateway</span>
            </div>
          </div>
        </div>

        <!-- Row 3: Lambda (left) and EKS (right) -->
        <div class="absolute left-[18%] top-[150px]">
          <div class="arch-node group" data-tooltip="Serverless (TypeScript/Go)">
            <div class="w-[72px] h-[40px] rounded-lg bg-emerald-500/20 border border-emerald-500/50 flex flex-col items-center justify-center group-hover:border-emerald-400 group-hover:bg-emerald-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="text-[10px] font-mono text-emerald-400 font-semibold">Lambda</span>
              <span class="text-[7px] text-emerald-400/70">TS / Go</span>
            </div>
          </div>
        </div>

        <div class="absolute right-[18%] top-[150px]">
          <div class="arch-node group" data-tooltip="Kubernetes (Tesco Microservices)">
            <div class="w-[72px] h-[40px] rounded-lg bg-emerald-500/20 border border-emerald-500/50 flex flex-col items-center justify-center group-hover:border-emerald-400 group-hover:bg-emerald-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="text-[10px] font-mono text-emerald-400 font-semibold">EKS</span>
              <span class="text-[7px] text-emerald-400/70">React SSR</span>
            </div>
          </div>
        </div>

        <!-- Row 4: Bedrock (far left), DynamoDB (center), Redis (far right) -->
        <div class="absolute left-3 top-[225px]">
          <div class="arch-node group" data-tooltip="Claude AI via Bedrock">
            <div class="w-[52px] h-[38px] rounded-lg bg-amber-500/20 border border-amber-500/50 border-dashed flex flex-col items-center justify-center group-hover:border-amber-400 group-hover:bg-amber-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="material-symbols-outlined text-amber-400 text-sm">psychology</span>
              <span class="text-[7px] font-mono text-amber-400">Bedrock</span>
            </div>
          </div>
        </div>

        <div class="absolute left-1/2 -translate-x-1/2 top-[225px]">
          <div class="arch-node group" data-tooltip="NoSQL - High Throughput">
            <div class="w-[80px] h-[38px] rounded-lg bg-purple-500/20 border border-purple-500/50 flex items-center justify-center group-hover:border-purple-400 group-hover:bg-purple-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="text-[10px] font-mono text-purple-400 font-semibold">DynamoDB</span>
            </div>
          </div>
        </div>

        <div class="absolute right-3 top-[225px]">
          <div class="arch-node group" data-tooltip="Session & Cache Layer">
            <div class="w-[52px] h-[38px] rounded-lg bg-red-500/20 border border-red-500/50 flex flex-col items-center justify-center group-hover:border-red-400 group-hover:bg-red-500/30 transition-all cursor-pointer backdrop-blur-sm">
              <span class="text-[8px] font-mono text-red-400 font-semibold">Redis</span>
              <span class="text-[6px] text-red-400/70">Cache</span>
            </div>
          </div>
        </div>

        <!-- Status bar -->
        <div class="absolute bottom-3 left-0 right-0 flex justify-center items-center gap-4">
          <div class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full animate-pulse"></span>
            <span class="text-[8px] font-mono text-slate-500">2M req/day</span>
          </div>
          <div class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 bg-indigo-400 rounded-full animate-pulse"></span>
            <span class="text-[8px] font-mono text-slate-500">&lt;50ms p99</span>
          </div>
          <div class="flex items-center gap-1.5">
            <span class="w-1.5 h-1.5 bg-amber-400 rounded-full animate-pulse"></span>
            <span class="text-[8px] font-mono text-slate-500">AI-Enhanced</span>
          </div>
        </div>
      </div>

      <!-- Tooltip -->
      <div id="arch-tooltip" class="absolute hidden px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-xs text-white shadow-xl pointer-events-none max-w-[180px]" style="z-index: 50;" role="tooltip">
      </div>
    </figure>
  </div>
</section>

<style>
  .arch-node {
    position: relative;
  }
</style>

<script>
  // Tooltip functionality
  document.addEventListener('DOMContentLoaded', () => {
    const tooltip = document.getElementById('arch-tooltip');
    const nodes = document.querySelectorAll('.arch-node[data-tooltip]');

    nodes.forEach(node => {
      node.addEventListener('mouseenter', (e) => {
        const text = (node as HTMLElement).dataset.tooltip;
        if (tooltip && text) {
          tooltip.textContent = text;
          tooltip.classList.remove('hidden');
        }
      });

      node.addEventListener('mousemove', (e) => {
        if (tooltip) {
          const rect = document.getElementById('arch-diagram')?.getBoundingClientRect();
          if (rect) {
            const x = (e as MouseEvent).clientX - rect.left;
            const y = (e as MouseEvent).clientY - rect.top;
            tooltip.style.left = `${Math.min(x + 10, rect.width - 190)}px`;
            tooltip.style.top = `${y - 35}px`;
          }
        }
      });

      node.addEventListener('mouseleave', () => {
        if (tooltip) {
          tooltip.classList.add('hidden');
        }
      });
    });
  });
</script>
